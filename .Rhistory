tibble(line = read_lines(purl_file)) %>%
filter(!str_detect(line, "Sys\\.getenv")) %>%
filter(!(line == "" & lead(line) == "")) %>%
pull(line) %>%
write_lines(purl_file)
read_lines(quarto_file)
quarto_path <- file.path("quarto", quarto_file)
file.path("quarto", quarto_file) %>%
read_lines()
file.path("quarto", quarto_file) %>%
read_lines() %>%
write_lines("test.qmd")
tools::md5sum("test.qmd")
tools::md5sum(file.path("quarto", quarto_file))
qmd <- file.path("quarto", quarto_file) %>%
read_lines()
which(qmd == "---")
quarto_file
download_link <- glue("[Download the R script for this page](../{purl_files})")
download_link <- glue("[Download the R script for this page](../{purl_file})")
download_link
!any(str_detect(qmd, download_link))
?append
qmd_download <- append(qmd,
values = c("", download_link, ""),
after = yaml_indices[2])
yaml_indices <- which(qmd == "---")
purl_file <- str_replace(quarto_file, "\\.qmd$", ".R") %>%
file.path("purl", .)
download_link <- glue("[Download the R script for this page](../{purl_file})")
qmd_download <- append(qmd,
values = c("", download_link, ""),
after = yaml_indices[2])
qmd_download
add_download_chunks <- function(quarto_file){
qmd <- file.path("quarto", quarto_file) %>%
read_lines()
yaml_indices <- which(qmd == "---")
purl_file <- str_replace(quarto_file, "\\.qmd$", ".R") %>%
file.path("purl", .)
download_link <- glue("[Download the R script for this page](../{purl_file})")
if (!any(str_detect(qmd, download_link))){
qmd_download <- append(qmd,
values = c("", download_link, ""),
after = yaml_indices[2])
write_lines(qmd, file.path("quarto", quarto_file))
}
}
library(tidyverse)
library(knitr)
library(glue)
rm(list = ls())
# 1. Extract Chunks ----
extract_chunks <- function(quarto_file){
purl_file <- str_replace(quarto_file, "\\.qmd$", ".R") %>%
file.path("purl", .)
purl(file.path("quarto", quarto_file),
purl_file,
documentation = 0)
tibble(line = read_lines(purl_file)) %>%
filter(!str_detect(line, "Sys\\.getenv")) %>%
filter(!(line == "" & lead(line) == "")) %>%
pull(line) %>%
write_lines(purl_file)
return(quarto_file)
}
walk(quarto_files, extract_chunks)
quarto_files <- list.files("quarto", "\\.qmd$")
# 1. Extract Chunks ----
extract_chunks <- function(quarto_file){
purl_file <- str_replace(quarto_file, "\\.qmd$", ".R") %>%
file.path("purl", .)
purl(file.path("quarto", quarto_file),
purl_file,
documentation = 0)
tibble(line = read_lines(purl_file)) %>%
filter(!str_detect(line, "Sys\\.getenv")) %>%
filter(!(line == "" & lead(line) == "")) %>%
pull(line) %>%
write_lines(purl_file)
return(quarto_file)
}
walk(quarto_files, extract_chunks)
# 2. Add Download ----
add_download_link <- function(quarto_file){
qmd <- file.path("quarto", quarto_file) %>%
read_lines()
yaml_indices <- which(qmd == "---")
purl_file <- str_replace(quarto_file, "\\.qmd$", ".R") %>%
file.path("purl", .)
download_link <- glue("[Download the R script for this page](../{purl_file})")
if (!any(str_detect(qmd, download_link))){
qmd_download <- append(qmd,
values = c("", download_link, ""),
after = yaml_indices[2])
write_lines(qmd, file.path("quarto", quarto_file))
}
}
# 2. Add Download ----
add_download_link <- function(quarto_file){
quarto_path <- file.path("quarto", quarto_file)
qmd <- read_lines(quarto_path)
yaml_indices <- which(qmd == "---")
download_link <- glue("[Download the R script for this page](../{purl_file})")
if (!any(str_detect(qmd, download_link))){
qmd_download <- append(qmd,
values = c("", download_link, ""),
after = yaml_indices[2])
write_lines(qmd_download, quarto_path)
return("Added download link")
} else{
return("Download link already exists")
}
}
walk(quarto_files, extract_chunks)
# 2. Add Download ----
add_download_link <- function(quarto_file){
quarto_path <- file.path("quarto", quarto_file)
qmd <- read_lines(quarto_path)
yaml_indices <- which(qmd == "---")
download_link <- glue("[Download the R script for this page](../{purl_file})")
if (!any(str_detect(qmd, download_link))){
qmd_download <- append(qmd,
values = c("", download_link, ""),
after = yaml_indices[2])
write_lines(qmd_download, quarto_path)
return("Added download link")
} else{
return("Download link already exists")
}
}
walk(quarto_files, add_download_link)
# 2. Add Download ----
add_download_link <- function(quarto_file){
quarto_path <- file.path("quarto", quarto_file)
qmd <- read_lines(quarto_path)
yaml_indices <- which(qmd == "---")
purl_file <- str_replace(quarto_file, "\\.qmd$", ".R") %>%
file.path("purl", .)
download_link <- glue("[Download the R script for this page](../{purl_file})")
if (!any(str_detect(qmd, download_link))){
qmd_download <- append(qmd,
values = c("", download_link, ""),
after = yaml_indices[2])
write_lines(qmd_download, quarto_path)
return("Added download link")
} else{
return("Download link already exists")
}
}
walk(quarto_files, add_download_link)
# 2. Add Download ----
add_download_link <- function(quarto_file){
quarto_path <- file.path("quarto", quarto_file)
qmd <- read_lines(quarto_path)
yaml_indices <- which(qmd == "---")
purl_file <- str_replace(quarto_file, "\\.qmd$", ".R") %>%
file.path("purl", .)
download_link <- glue("[Download the R script for this page](../{purl_file})")
if (!any(str_detect(qmd, download_link))){
qmd_download <- append(qmd,
values = c("", download_link, ""),
after = yaml_indices[2])
write_lines(qmd_download, quarto_path)
return("Added download link")
} else{
return("Download link already exists")
}
}
map(quarto_files, add_download_link)
quarto_files <- list.files("quarto", "\\.qmd$") %>%
set_names(., .)
# 1. Extract Chunks ----
extract_chunks <- function(quarto_file){
purl_file <- str_replace(quarto_file, "\\.qmd$", ".R") %>%
file.path("purl", .)
purl(file.path("quarto", quarto_file),
purl_file,
documentation = 0)
tibble(line = read_lines(purl_file)) %>%
filter(!str_detect(line, "Sys\\.getenv")) %>%
filter(!(line == "" & lead(line) == "")) %>%
pull(line) %>%
write_lines(purl_file)
return(quarto_file)
}
walk(quarto_files, extract_chunks)
# 2. Add Download ----
add_download_link <- function(quarto_file){
quarto_path <- file.path("quarto", quarto_file)
qmd <- read_lines(quarto_path)
yaml_indices <- which(qmd == "---")
purl_file <- str_replace(quarto_file, "\\.qmd$", ".R") %>%
file.path("purl", .)
download_link <- glue("[Download the R script for this page](../{purl_file})")
if (!any(str_detect(qmd, download_link))){
qmd_download <- append(qmd,
values = c("", download_link, ""),
after = yaml_indices[2])
write_lines(qmd_download, quarto_path)
return("Added download link")
} else{
return("Download link already exists")
}
}
map(quarto_files, add_download_link)
map(quarto_files, add_download_link)
# 2. Add Download ----
add_download_link <- function(quarto_file){
quarto_path <- file.path("quarto", quarto_file)
qmd <- read_lines(quarto_path)
yaml_indices <- which(qmd == "---")
purl_file <- str_replace(quarto_file, "\\.qmd$", ".R") %>%
file.path("purl", .)
download_link <- glue("[Download the R script for this page](../{purl_file})")
if (!any(str_detect(qmd, "Download the R script for this page"))){
qmd_download <- append(qmd,
values = c("", download_link, ""),
after = yaml_indices[2])
write_lines(qmd_download, quarto_path)
return("Added download link")
} else{
return("Download link already exists")
}
}
map(quarto_files, add_download_link)
# 2. Add Download ----
add_download_link <- function(quarto_file){
quarto_path <- file.path("quarto", quarto_file)
qmd <- read_lines(quarto_path)
yaml_indices <- which(qmd == "---")
purl_file <- str_replace(quarto_file, "\\.qmd$", ".R") %>%
file.path("purl", .)
download_link <- glue("[Download the R script for this page](../{purl_file})")
if (!any(str_detect(qmd, "Download the R script for this page"))){
qmd_download <- append(qmd,
values = c("", download_link, ""),
after = yaml_indices[2]) %>%
tibble(line = .) %>%
filter(!(line == "" & lead(line) == "")) %>%
pull(line)
write_lines(qmd_download, quarto_path)
return("Added download link")
} else{
return("Download link already exists")
}
}
map(quarto_files, add_download_link)
# 3. Remove Download Link ----
remove_download_link <- function(quarto_file){
quarto_path <- file.path("quarto", quarto_file)
qmd <- read_lines(quarto_path)
if (any(str_detect(qmd, "Download the R script for this page"))){
qmd_remove <- tibble(line = qmd) %>%
filter(!str_detect(line, "Download the R script for this page")) %>%
filter(!(line == "" & lead(line) == "")) %>%
pull(line)
write_lines(qmd_remove, quarto_path)
return("Removed download link")
} else{
return("No link present")
}
}
map(quarto_files, remove_download_link)
# 2. Add Download Link ----
add_download_link <- function(quarto_file){
quarto_path <- file.path("quarto", quarto_file)
qmd <- read_lines(quarto_path)
yaml_indices <- which(qmd == "---")
purl_file <- str_replace(quarto_file, "\\.qmd$", ".R") %>%
file.path("purl", .)
download_link <- glue("[Download the R script for this page](../{purl_file})")
if (!any(str_detect(qmd, "Download the R script for this page"))){
qmd_download <- append(qmd,
values = c("", download_link, ""),
after = yaml_indices[2]) %>%
tibble(line = .) %>%
filter(!(line == "" & lead(line) == "")) %>%
pull(line)
write_lines(qmd_download, quarto_path)
return("Added download link")
} else{
return("Download link already exists")
}
}
map(quarto_files, add_download_link)
# 1. Extract Chunks ----
extract_chunks <- function(quarto_file){
purl_file <- str_replace(quarto_file, "\\.qmd$", ".R") %>%
file.path("purl", .)
purl(file.path("quarto", quarto_file),
purl_file,
documentation = 0)
tibble(line = read_lines(purl_file)) %>%
filter(!str_detect(line, "Sys\\.getenv")) %>%
filter(!(line == "" & lead(line) == "")) %>%
pull(line) %>%
write_lines(purl_file)
return(quarto_file)
}
walk(quarto_files, extract_chunks)
library(quarto)
quarto_file
make_quarto("bcs70-merging_across_sweeps.qmd")
# 4. Render Quarto Pages ----
make_quarto <- function(quarto_file){
quarto_path <- file.path("quarto", quarto_file)
md_path <- str_replace(quarto_file, "\\.qmd$", ".md")
study <- str_extract(quarto, "^[^-]+")
study_fld <- glue("{study}_fld")
quarto_render(quarto_path,
output_file = md_path,
execute_dir = study_fld)
}
make_quarto("bcs70-merging_across_sweeps.qmd")
library(quarto)
make_quarto("bcs70-merging_across_sweeps.qmd")
quarto_file <- "bcs70-merging_across_sweeps.qmd"
quarto_path <- file.path("quarto", quarto_file)
md_path <- str_replace(quarto_file, "\\.qmd$", ".md")
study <- str_extract(quarto, "^[^-]+")
study <- str_extract(quarto_file, "^[^-]+")
study_fld <- glue("{study}_fld")
study_fld
usethis::edit_r_environ("project")
# 4. Render Quarto Pages ----
make_quarto <- function(quarto_file){
quarto_path <- file.path("quarto", quarto_file)
md_path <- str_replace(quarto_file, "\\.qmd$", ".md")
study <- str_extract(quarto_file, "^[^-]+")
study_fld <- glue("{study}_fld")
quarto_render(quarto_path,
output_file = md_path,
execute_dir = study_fld)
}
make_quarto("bcs70-merging_across_sweeps.qmd")
# 4. Render Quarto Pages ----
make_quarto <- function(quarto_file){
quarto_path <- file.path("quarto", quarto_file)
md_path <- str_replace(quarto_file, "\\.qmd$", ".md")
study <- str_extract(quarto_file, "^[^-]+")
study_fld <- glue("{study}_fld") %>% Sys.getenv()
quarto_render(quarto_path,
output_file = md_path,
execute_dir = study_fld)
}
make_quarto("bcs70-merging_across_sweeps.qmd")
#| warning: false
# Load Packages
library(tidyverse) # For data manipulation
library(haven) # For importing .dta files
#| include: false
# setwd(Sys.getenv("mcs_fld"))
df_42y <- read_dta("42y/bcs70_2012_derived.dta",
col_select = c("BCSID", "BD9HGHTM"))
setwd(study_fld)
study_fld <- glue("{study}_fld") %>% Sys.getenv()
setwd(study_fld)
df_42y <- read_dta("42y/bcs70_2012_derived.dta",
col_select = c("BCSID", "BD9HGHTM"))
df_42y <- read_dta("42y/bcs70_2012_derived.dta",
col_select = c("BCSID", "BD9HGHTM"))
df_51y <- read_dta("51y/bcs11_age51_main.dta",
col_select = c("bcsid", "bd11hghtm"))
df_42y %>%
full_join(df_51y, by = c(BCSID = "bcsid"))
df_42y %>%
inner_join(df_51y, by = c(BCSID = "bcsid"))
df_42y %>%
left_join(df_51y, by = c(BCSID = "bcsid"))
df_42y %>%
right_join(df_51y, by = c(BCSID = "bcsid"))
df_42y %>%
rename_with(str_to_lower) %>% # Converts all variable names to upper case
full_join(df_51y)
df_42y_nosuffix <- df_42y %>%
rename_with(str_to_lower) %>%
rename_with(~ str_remove(.x, "^bd9")) %>%  # Removes the suffix '23' from variable names
mutate(sweep = 9, .before = 1)
df_51y_nosuffix <- df_51y %>%
rename_with(~ str_remove(.x, "^bd11")) %>%
mutate(sweep = 11, .before = 1)
df_42y_nosuffix
df_51y_nosuffix
bind_rows(df_42y_nosuffix, df_51y_nosuffix) %>%
arrange(bcsid, sweep)
bind_rows(df_42y_nosuffix, df_51y_nosuffix) %>%
arrange(bcsid, sweep) # Sorts the dataset by ID and sweep
bind_rows(df_42y_nosuffix, df_51y_nosuffix) %>%
complete(bcsid, sweep) %>% # Ensure cohort members have a row for each sweep
arrange(bcsid, sweep)
make_quarto("bcs70-merging_across_sweeps.qmd")
library(tidyverse)
library(knitr)
library(glue)
library(quarto)
rm(list = ls())
# 0. Set Up Environment ----
dir.create("purl")
quarto_files <- list.files("quarto", "\\.qmd$") %>%
set_names(., .)
# quarto_file <- "bcs70-data_discovery.qmd"
# 1. Extract Chunks ----
extract_chunks <- function(quarto_file){
purl_file <- str_replace(quarto_file, "\\.qmd$", ".R") %>%
file.path("purl", .)
purl(file.path("quarto", quarto_file),
purl_file,
documentation = 0)
tibble(line = read_lines(purl_file)) %>%
filter(!str_detect(line, "Sys\\.getenv")) %>%
filter(!(line == "" & lead(line) == "")) %>%
pull(line) %>%
write_lines(purl_file)
return(quarto_file)
}
walk(quarto_files, extract_chunks)
# 2. Add Download Link ----
add_download_link <- function(quarto_file){
quarto_path <- file.path("quarto", quarto_file)
qmd <- read_lines(quarto_path)
yaml_indices <- which(qmd == "---")
purl_file <- str_replace(quarto_file, "\\.qmd$", ".R") %>%
file.path("purl", .)
download_link <- glue("[Download the R script for this page](../{purl_file})")
if (!any(str_detect(qmd, "Download the R script for this page"))){
qmd_download <- append(qmd,
values = c("", download_link, ""),
after = yaml_indices[2]) %>%
tibble(line = .) %>%
filter(!(line == "" & lead(line) == "")) %>%
pull(line)
write_lines(qmd_download, quarto_path)
return("Added download link")
} else{
return("Download link already exists")
}
}
map(quarto_files, add_download_link)
# 3. Remove Download Link ----
remove_download_link <- function(quarto_file){
quarto_path <- file.path("quarto", quarto_file)
qmd <- read_lines(quarto_path)
if (any(str_detect(qmd, "Download the R script for this page"))){
qmd_remove <- tibble(line = qmd) %>%
filter(!str_detect(line, "Download the R script for this page")) %>%
filter(!(line == "" & lead(line) == "")) %>%
pull(line)
write_lines(qmd_remove, quarto_path)
return("Removed download link")
} else{
return("No link present")
}
}
map(quarto_files, remove_download_link)
# 4. Render Quarto Pages ----
make_quarto <- function(quarto_file){
quarto_path <- file.path("quarto", quarto_file)
md_path <- str_replace(quarto_file, "\\.qmd$", ".md")
study <- str_extract(quarto_file, "^[^-]+")
study_fld <- glue("{study}_fld") %>% Sys.getenv()
quarto_render(quarto_path,
output_file = md_path,
execute_dir = study_fld)
}
make_quarto("bcs70-merging_across_sweeps.qmd")
make_quarto("bcs70-merging_across_sweeps.qmd")
library(tidyverse)
library(knitr)
library(glue)
library(quarto)
rm(list = ls())
make_quarto("bcs70-merging_across_sweeps.qmd")
# 4. Render Quarto Pages ----
make_quarto <- function(quarto_file){
quarto_path <- file.path("quarto", quarto_file)
md_path <- str_replace(quarto_file, "\\.qmd$", ".md")
study <- str_extract(quarto_file, "^[^-]+")
study_fld <- glue("{study}_fld") %>% Sys.getenv()
quarto_render(quarto_path,
output_file = md_path,
execute_dir = study_fld)
}
make_quarto("bcs70-merging_across_sweeps.qmd")
quarto_file <- "bcs70-merging_across_sweeps.qmd"
quarto_path <- file.path("quarto", quarto_file)
md_path <- str_replace(quarto_file, "\\.qmd$", ".md")
study <- str_extract(quarto_file, "^[^-]+")
study_fld <- glue("{study}_fld") %>% Sys.getenv()
quarto_render(quarto_path,
output_file = md_path,
execute_dir = study_fld)
getwd()
setwd("/Users/liamwright/Library/CloudStorage/GoogleDrive-liam.jwright@googlemail.com/Other computers/My PC/Research/Projects/CLS MSEU/Subprojects/Website")
make_quarto("bcs70-merging_across_sweeps.qmd")
getwd
getwd()
# 4. Render Quarto Pages ----
make_quarto <- function(quarto_file){
quarto_path <- file.path("quarto", quarto_file)
md_path <- str_replace(quarto_file, "\\.qmd$", ".md")
study <- str_extract(quarto_file, "^[^-]+")
study_fld <- glue("{study}_fld") %>% Sys.getenv()
quarto_render(quarto_path,
output_file = md_path,
execute_dir = study_fld)
}
map(quarto_files, make_quarto)
quarto_files <- list.files("quarto", "\\.qmd$") %>%
set_names(., .)
map(quarto_files, make_quarto)
reticulate::repl_python()
